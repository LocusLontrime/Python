# accepted on codewars.com
def knapsack(items: list[tuple[int, int]], w_limit):
    memo_table, n = {}, len(items)                                           # 36 36.6 98 989 98989 LL
    dp = [[0 for _ in range(w_limit + 1)] for _ in range(n + 1)]
    for k in range(1, n + 1):
        for s in range(1, w_limit + 1):
            if s >= items[k - 1][0]:
                dp[k][s] = max(dp[k - 1][s], dp[k - 1][s - items[k - 1][0]] + items[k - 1][1])
            else:
                dp[k][s] = dp[k - 1][s]
    r = find_ans(n, w_limit, items, 0, temp := dp[n][w_limit], memo_table, dp)
    results = set(tuple(sorted(path[1:])) for path in r if sum(path) == temp)
    return [temp, sorted(list(list(res)) for res in results)]


def find_ans(k: int, s: int, items: list[tuple[int, int]], sum_: int, max_sum: int, memo_table, dp) -> list:
    if s >= 0 and dp[k][s] == max_sum - sum_:
        if dp[k][s] == 0:
            return [[0]]
        if (k, s) not in memo_table.keys():
            r1 = [path + [items[k - 1][1]] for path in find_ans(k - 1, s - items[k - 1][0], items, sum_ + items[k - 1][1], max_sum, memo_table, dp)]
            if dp[k - 1][s] == dp[k][s]:
                r1 += find_ans(k - 1, s, items, sum_, max_sum, memo_table, dp)
            memo_table[(k, s)] = r1
        return memo_table[(k, s)]
    return []


items_ = [(2, 3), (6, 5), (8, 2), (4, 5), (2, 8), (5, 5), (2, 2)]
w_limit_ = 7

items_great = [(29, 24), (28, 3), (9, 11), (48, 10), (3, 44), (37, 42), (5, 30), (45, 33), (1, 24), (1, 5), (45, 19), (2, 47), (44, 49), (38, 37), (4, 40), (31, 3), (12, 2), (45, 16), (8, 44), (44, 17), (48, 14), (49, 18), (24, 4), (27, 48), (19, 26), (26, 47), (25, 9), (32, 33), (39, 5), (18, 25), (25, 38), (5, 11), (33, 22), (17, 14), (17, 13), (6, 38), (36, 39), (24, 17), (30, 8), (11, 7), (31, 17), (21, 27), (46, 40), (34, 40), (41, 33), (29, 48), (39, 11), (50, 16), (40, 35), (18, 5), (18, 48), (35, 45), (5, 17), (45, 32), (49, 2), (14, 45), (48, 18), (3, 39), (39, 30), (2, 17), (32, 8), (50, 10), (14, 26), (26, 41), (21, 10), (11, 49), (12, 33), (5, 8), (12, 16), (50, 28), (47, 36), (5, 40), (30, 36), (35, 31), (8, 45), (47, 16), (42, 28), (30, 10), (17, 47), (50, 19), (32, 11), (26, 2), (36, 2), (21, 8), (16, 36), (34, 24), (3, 42), (5, 4), (2, 30), (29, 21), (35, 17), (12, 1), (41, 26), (26, 42), (21, 2), (5, 41), (44, 32), (48, 1), (1, 6), (13, 39), (39, 45), (30, 15), (47, 4), (46, 34), (42, 47), (20, 9), (33, 39), (46, 24), (21, 6), (7, 36), (35, 19), (3, 35), (9, 33), (30, 22), (34, 36), (29, 37), (32, 7), (5, 32), (6, 16), (9, 29), (10, 32), (4, 46), (9, 31), (11, 39), (14, 25), (11, 30), (1, 40), (14, 48), (37, 47), (43, 13), (5, 8), (49, 25), (47, 34), (19, 4), (16, 11), (47, 32), (33, 42), (16, 22), (36, 16), (8, 7), (8, 32), (41, 12), (45, 35), (48, 11), (29, 40), (7, 6), (48, 32), (22, 30), (47, 50), (23, 45), (43, 45), (38, 32), (29, 34), (17, 15), (22, 42), (24, 46), (5, 26), (21, 1), (36, 10), (26, 2), (41, 10), (29, 18), (33, 31), (40, 46), (45, 30), (24, 17), (11, 33), (23, 33), (36, 16), (1, 26), (16, 34), (39, 23), (24, 35), (1, 36), (8, 25), (45, 5), (24, 35), (31, 2), (28, 38), (43, 15), (20, 15), (40, 6), (20, 9), (41, 8), (17, 44), (35, 33), (35, 38), (35, 12), (24, 23), (38, 47), (32, 20), (3, 32), (26, 30), (5, 10), (24, 35), (8, 35), (29, 47), (37, 14), (29, 19), (1, 21), (38, 9), (45, 46), (6, 48), (38, 42), (22, 7), (48, 14), (26, 49), (8, 37), (48, 29), (16, 30), (39, 20), (42, 21), (43, 7), (43, 20), (31, 35), (39, 40), (10, 18), (8, 2), (35, 22), (33, 25), (40, 14), (25, 45), (12, 49), (40, 26), (41, 28), (39, 10), (41, 31), (23, 29), (20, 47), (45, 23), (18, 30), (37, 48), (22, 29), (11, 12), (3, 41), (45, 34), (3, 29), (20, 8), (41, 18), (34, 29), (28, 37), (18, 47), (12, 5), (7, 32), (6, 43), (2, 21), (6, 18), (44, 49), (25, 39), (4, 15), (9, 29), (48, 17), (47, 28), (45, 26), (15, 25), (48, 41), (27, 47), (8, 2), (29, 49), (13, 50), (36, 24), (29, 23), (27, 34), (31, 16), (14, 39), (38, 44), (29, 9), (22, 23), (8, 19), (34, 39), (50, 28), (17, 23), (4, 19), (47, 50), (8, 34), (38, 42), (8, 47), (36, 6), (15, 7), (12, 1), (35, 2), (17, 22), (27, 18), (35, 14), (49, 36), (21, 49), (47, 3), (40, 6), (15, 41), (36, 49), (18, 50), (33, 24), (46, 50), (11, 41), (2, 8), (7, 43), (20, 10), (25, 50), (29, 18), (37, 40), (50, 3), (5, 48), (10, 16), (32, 26), (13, 19), (29, 34), (4, 42), (2, 31), (21, 16), (38, 26), (7, 4), (19, 35), (37, 8), (33, 18), (8, 19), (48, 42), (35, 41), (40, 44), (43, 37), (41, 9), (27, 16), (47, 5), (12, 41), (40, 42), (34, 5), (13, 36), (50, 14), (16, 41), (14, 49), (38, 21), (28, 3), (31, 36), (14, 13), (14, 28), (35, 16), (29, 45), (14, 11), (36, 36), (10, 2), (11, 32), (42, 29), (42, 26), (15, 18), (43, 38), (35, 13), (35, 38), (3, 42), (21, 20), (44, 34), (39, 33), (13, 41), (44, 48), (14, 11), (15, 16), (10, 39), (46, 13), (20, 19), (20, 29), (6, 9), (7, 3), (19, 18), (19, 3), (16, 37), (43, 25), (27, 17), (3, 35), (48, 3), (11, 43), (47, 19), (18, 23), (45, 48), (49, 13), (31, 40), (47, 33), (48, 45), (10, 40), (18, 30), (44, 29), (4, 42), (39, 50), (19, 7), (16, 47), (34, 50), (42, 32), (29, 12), (14, 17), (14, 11), (31, 5), (32, 27), (12, 16), (33, 10), (39, 1), (28, 41), (9, 3), (18, 5), (45, 31), (26, 13), (31, 11), (40, 37), (2, 48), (39, 9), (11, 20), (13, 30), (27, 11), (9, 28), (36, 11), (17, 10), (13, 22), (39, 42), (32, 41), (42, 35), (18, 11), (19, 14), (17, 1), (32, 11), (8, 13), (11, 36), (25, 16), (21, 50), (1, 9), (48, 24), (20, 46), (23, 45), (28, 28), (26, 11), (17, 37), (2, 8), (27, 3), (12, 42), (6, 50), (31, 31), (16, 28), (6, 19), (15, 23), (24, 22), (38, 16), (17, 9), (18, 45), (14, 28), (33, 32), (6, 33), (47, 30), (12, 11), (17, 2), (25, 46), (38, 1), (37, 29), (37, 33), (21, 35), (22, 34), (47, 49), (47, 34), (43, 31), (33, 3), (47, 21), (38, 40), (37, 22), (17, 6), (22, 25), (40, 15), (41, 41), (24, 18), (40, 37), (33, 16), (40, 42), (45, 32), (48, 35), (24, 29), (26, 7), (46, 27), (7, 31), (33, 13), (28, 46), (47, 35), (46, 13), (40, 30), (35, 21), (31, 4), (40, 26), (34, 18), (15, 6), (21, 23), (44, 28), (21, 10), (24, 16), (49, 30), (14, 42), (16, 41), (3, 4), (12, 36), (45, 5), (12, 5), (48, 14), (34, 25), (17, 3), (50, 6), (7, 2), (24, 11), (50, 31), (40, 19)]
w_limit_great = 62

items_x = [(1, 13), (3, 17), (1, 12), (10, 19), (6, 5), (8, 11), (6, 7), (19, 2), (17, 18), (6, 5), (1, 1), (14, 12), (4, 18), (13, 6), (6, 7)]
w_limit_x = 45

items_err = [(15, 11), (9, 6), (8, 15), (19, 4), (6, 5), (2, 13), (16, 19), (17, 20), (11, 10), (18, 9), (7, 16)]
w_limit_err = 36

items_z = [(12, 11), (20, 4), (12, 11), (15, 12), (6, 12), (8, 20), (19, 11), (5, 3), (5, 2), (12, 15), (2, 18), (4, 12), (10, 14), (5, 3), (20, 14)]
w_limit_z = 28

print(f'res: {knapsack(items_z, w_limit_z)}')
